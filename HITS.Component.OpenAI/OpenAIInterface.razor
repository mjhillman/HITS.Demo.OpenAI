@page "/"

@using MudBlazor

<MudText Typo="Typo.h5">Text Completion Endpoint Test Interface</MudText>
<br />
<MudGrid Justify="Justify.FlexStart">
    <MudItem xs="12" sm="7">
        <MudPaper>
            <MudText Typo="Typo.body1">
                While safeguards are in place, the system may occasionally generate incorrect or misleading information and produce offensive or biased content. It is not intended to give advice.
                Please don't share any sensitive information in your conversations.<br />
            </MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="7">
        <MudTextField Label="Submit a question."
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense"
                      Lines="5"
                      @bind-Value="openAIRequest.Prompt" />
        <br />
        <MudSelect @bind-Value="@openAIRequest.Model" 
            Label="Model Choices" 
            Variant="Variant.Outlined">
            <MudSelectItem Value="@("text-davinci-003")">Davinci (default)</MudSelectItem>
            <MudSelectItem Value="@("text-curie-001")">Curie</MudSelectItem>
            <MudSelectItem Value="@("text-babbage-001")">Babbage</MudSelectItem>
            <MudSelectItem Value="@("text-ada-001")">Ada</MudSelectItem>
        </MudSelect>
        <br />
        <MudSlider @bind-Value="@openAIRequest.MaxTokens"
                   Min="16"
                   Max="2048"
                   Step="8"
                   Class="border-solid border-2 pa-4 rounded">
            Max Tokens: @openAIRequest.MaxTokens.ToString()
        </MudSlider>
        <br /><br />
        <MudTooltip Placement="Placement.Right" Delay="2000">
            <ChildContent>
                <MudSlider @bind-Value="@openAIRequest.Temperature"
                           Min="0.0"
                           Max="1.0"
                           Step="0.1"
                           Class="border-solid border-2 pa-4 rounded">
                    Temperature: @openAIRequest.Temperature.ToString()
                </MudSlider>
            </ChildContent>
            <TooltipContent>
                <MudText Typo="Typo.body1">
                    OpenAI temperature is a parameter used to control the <br />
                    randomness of text generated by OpenAI's GPT-3 language model. <br />
                    It is a measure of how much the model should deviate from the <br />
                    training data when generating new text. A higher temperature <br />
                    will result in more creative and varied output, while a lower <br />
                    temperature will produce more conservative and accurate results.
                </MudText>
            </TooltipContent>
        </MudTooltip>
        <br /><br />
        <MudButton Variant="Variant.Filled"
                   @onclick="OnSubmitAsync"
                   Color="Color.Primary">
            Submit<br />
        </MudButton>
    </MudItem>
    <MudItem xs="12" sm="7">
        <MudPaper>
            <MudText Typo="Typo.body1">@response</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private string response = "";

    private OpenAIRequest openAIRequest = new OpenAIRequest();

    [Parameter]
    public string ApiKey { get; set; }

    [Parameter]
    public string OrgId { get; set; }

    private async Task OnSubmitAsync()
    {
        try
        {
            response = "";
            if (!string.IsNullOrWhiteSpace(openAIRequest.Prompt))
            {
                using (OpenAI openAI = new OpenAI(ApiKey, OrgId))
                {
                    response = openAI.CallOpenAI(openAIRequest);
                }
            }
        }
        catch (Exception)
        {
            throw;
        }
    }

    protected override void OnInitialized()
    {
        openAIRequest.Prompt = "Who was Thomas Paine?";
        openAIRequest.Temperature = 0;
        openAIRequest.Model = "text-davinci-003";
        openAIRequest.MaxTokens = 256;
    }
}